(set-logic SEPLOG)

(declare-sort Ref 1)

(declare-datatype dll1_t ((empty) (dll1_cons (next (Ref dll1_t)) (prev (Ref dll1_t)))))

(declare-datatype dll2_t ((empty) (dll2_cons (next (Ref dll2_t)) (prev (Ref dll2_t)) (down (Ref dll1_t)))))

(define-fun-rec dll1_plus ((hd (Ref dll1_t)) (pr (Ref dll1_t))) Bool
    (or (pto hd (dll1_cons (as nil (Ref dll1_t)) pr))
        (exists ((x (Ref dll1_t))) (sep (pto hd (dll1_cons x pr)) (dll1_plus x hd))))
)

(define-fun-rec dllseg2_plus ((hd (Ref dll2_t)) (pr (Ref dll2_t)) 
                              (tl (Ref dll2_t)) (nx (Ref dll2_t))) Bool
    (or (exists ((down_hd (Ref dll1_t)))
            (and (= hd tl)
                 (sep (pto hd (dll2_cons nx pr down_hd))
                      (dll1_plus down_hd (as nil (Ref dll1_t))))))
        (exists ((x (Ref dll2_t)) (down_hd (Ref dll1_t)))
            (sep (pto hd (dll2_cons x pr down_hd))
                 (dll1_plus down_hd (as nil (Ref dll1_t)))
                 (dllseg2_plus x hd tl nx))))
)

(define-fun-rec dllseg2_plus_rev ((hd (Ref dll2_t)) (pr (Ref dll2_t)) 
                                  (tl (Ref dll2_t)) (nx (Ref dll2_t))) Bool
    (or (exists ((down_hd (Ref dll1_t)))
            (and (= hd tl)
                 (sep (pto hd (dll2_cons nx pr down_hd))
                      (dll1_plus down_hd (as nil (Ref dll1_t))))))
        (exists ((x (Ref dll2_t)) (down_hd (Ref dll1_t)))
            (sep (pto tl (dll2_cons nx x down_hd))
                 (dll1_plus down_hd (as nil (Ref dll1_t)))
                 (dllseg2_plus_rev hd pr x tl))))
)

(declare-const hd0 (Ref dll2_t))
(declare-const tl0 (Ref dll2_t))
(declare-const hd1 (Ref dll2_t))
(declare-const tl1 (Ref dll2_t))
(declare-const hd2 (Ref dll2_t))
(declare-const tl2 (Ref dll2_t))
(declare-const hd3 (Ref dll2_t))
(declare-const tl3 (Ref dll2_t))
(declare-const hd4 (Ref dll2_t))
(declare-const tl4 (Ref dll2_t))
(declare-const hd5 (Ref dll2_t))
(declare-const tl5 (Ref dll2_t))
(declare-const hd6 (Ref dll2_t))
(declare-const tl6 (Ref dll2_t))
(declare-const hd7 (Ref dll2_t))
(declare-const tl7 (Ref dll2_t))
(declare-const hd8 (Ref dll2_t))
(declare-const tl8 (Ref dll2_t))
(declare-const hd9 (Ref dll2_t))
(declare-const tl9 (Ref dll2_t))
(declare-const hd10 (Ref dll2_t))
(declare-const tl10 (Ref dll2_t))
(declare-const hd11 (Ref dll2_t))
(declare-const tl11 (Ref dll2_t))
(declare-const hd12 (Ref dll2_t))
(declare-const tl12 (Ref dll2_t))
(declare-const hd13 (Ref dll2_t))
(declare-const tl13 (Ref dll2_t))
(declare-const hd14 (Ref dll2_t))
(declare-const tl14 (Ref dll2_t))
(declare-const hd15 (Ref dll2_t))
(declare-const tl15 (Ref dll2_t))
(declare-const hd16 (Ref dll2_t))
(declare-const tl16 (Ref dll2_t))
(declare-const hd17 (Ref dll2_t))
(declare-const tl17 (Ref dll2_t))
(declare-const hd18 (Ref dll2_t))
(declare-const tl18 (Ref dll2_t))
(declare-const hd19 (Ref dll2_t))
(declare-const tl19 (Ref dll2_t))
(declare-const hd20 (Ref dll2_t))
(declare-const tl20 (Ref dll2_t))

(assert (sep (dllseg2_plus hd0 (as nil (Ref dll2_t)) tl0 hd1)
             (dllseg2_plus hd1 hd0 tl1 hd2)
             (dllseg2_plus hd2 hd1 tl2 hd3)
             (dllseg2_plus hd3 hd2 tl3 hd4)
             (dllseg2_plus hd4 hd3 tl4 hd5)
             (dllseg2_plus hd5 hd4 tl5 hd6)
             (dllseg2_plus hd6 hd5 tl6 hd7)
             (dllseg2_plus hd7 hd6 tl7 hd8)
             (dllseg2_plus hd8 hd7 tl8 hd9)
             (dllseg2_plus hd9 hd8 tl9 hd10)
             (dllseg2_plus hd10 hd9 tl10 hd11)
             (dllseg2_plus hd11 hd10 tl11 hd12)
             (dllseg2_plus hd12 hd11 tl12 hd13)
             (dllseg2_plus hd13 hd12 tl13 hd14)
             (dllseg2_plus hd14 hd13 tl14 hd15)
             (dllseg2_plus hd15 hd14 tl15 hd16)
             (dllseg2_plus hd16 hd15 tl16 hd17)
             (dllseg2_plus hd17 hd16 tl17 hd18)
             (dllseg2_plus hd18 hd17 tl18 hd19)
             (dllseg2_plus hd19 hd18 tl19 hd20)
             (dllseg2_plus hd20 hd19 tl20 (as nil (Ref dll2_t)))
        )
)

(assert (not (sep (dllseg2_plus_rev hd0 (as nil (Ref dll2_t)) tl0 hd1)
                  (dllseg2_plus_rev hd1 hd0 tl1 hd2)
                  (dllseg2_plus_rev hd2 hd1 tl2 hd3)
                  (dllseg2_plus_rev hd3 hd2 tl3 hd4)
                  (dllseg2_plus_rev hd4 hd3 tl4 hd5)
                  (dllseg2_plus_rev hd5 hd4 tl5 hd6)
                  (dllseg2_plus_rev hd6 hd5 tl6 hd7)
                  (dllseg2_plus_rev hd7 hd6 tl7 hd8)
                  (dllseg2_plus_rev hd8 hd7 tl8 hd9)
                  (dllseg2_plus_rev hd9 hd8 tl9 hd10)
                  (dllseg2_plus_rev hd10 hd9 tl10 hd11)
                  (dllseg2_plus_rev hd11 hd10 tl11 hd12)
                  (dllseg2_plus_rev hd12 hd11 tl12 hd13)
                  (dllseg2_plus_rev hd13 hd12 tl13 hd14)
                  (dllseg2_plus_rev hd14 hd13 tl14 hd15)
                  (dllseg2_plus_rev hd15 hd14 tl15 hd16)
                  (dllseg2_plus_rev hd16 hd15 tl16 hd17)
                  (dllseg2_plus_rev hd17 hd16 tl17 hd18)
                  (dllseg2_plus_rev hd18 hd17 tl18 hd19)
                  (dllseg2_plus_rev hd19 hd18 tl19 hd20)
                  (dllseg2_plus_rev hd20 hd19 tl20 (as nil (Ref dll2_t))))
        )
)

(check-sat)